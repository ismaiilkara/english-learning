<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Practice - English Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }

        .passage-text {
            line-height: 1.8;
        }

        .passage-text p {
            margin-bottom: 1rem;
            text-indent: 0;
        }

        .paragraph-label {
            color: #ec4899;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .radio-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .radio-option.selected {
            background: rgba(236, 72, 153, 0.2);
            border-color: #ec4899;
        }

        .radio-option.correct {
            background: rgba(34, 197, 94, 0.2) !important;
            border-color: #22c55e !important;
        }

        .radio-option.incorrect {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: #ef4444 !important;
        }

        .fill-input {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .fill-input:focus {
            border-color: #ec4899;
            outline: none;
        }

        .fill-input.correct {
            border-color: #22c55e !important;
            background: rgba(34, 197, 94, 0.1) !important;
        }

        .fill-input.incorrect {
            border-color: #ef4444 !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
    </style>
</head>

<body class="text-white" x-data="ieltsApp()">

    <!-- Navigation -->
    <nav class="bg-black/30 backdrop-blur-xl border-b border-white/10 px-8 py-4 sticky top-0 z-50">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-6">
                <a href="index.html" class="text-2xl font-bold">
                    üéì <span class="bg-gradient-to-r from-pink-400 to-yellow-400 bg-clip-text text-transparent">IELTS
                        Practice</span>
                </a>
                <!-- Test Set Selector -->
                <select x-model="selectedTestSet" @change="loadTestSet()"
                    class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white">
                    <template x-for="test in testSets" :key="test.id">
                        <option :value="test.id" x-text="test.name" class="bg-gray-800"></option>
                    </template>
                </select>
                <!-- Passage Selector -->
                <select x-model="currentPassageIndex" @change="loadPassage()"
                    class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white">
                    <template x-for="(passage, index) in currentPassages" :key="index">
                        <option :value="index" x-text="'Passage ' + (index + 1)" class="bg-gray-800"></option>
                    </template>
                </select>
            </div>
            <!-- Section Tabs -->
            <div class="flex gap-2">
                <button @click="currentSection = 'reading'"
                    :class="currentSection === 'reading' ? 'bg-pink-500' : 'bg-white/10 hover:bg-white/20'"
                    class="px-6 py-2 rounded-full font-semibold transition-all">
                    üìñ Reading
                </button>
                <button @click="currentSection = 'listening'"
                    :class="currentSection === 'listening' ? 'bg-green-500' : 'bg-white/10 hover:bg-white/20'"
                    class="px-6 py-2 rounded-full font-semibold transition-all">
                    üéß Listening
                </button>
                <button class="px-6 py-2 rounded-full font-semibold bg-white/10 opacity-50 cursor-not-allowed" disabled>
                    ‚úçÔ∏è Writing
                </button>
                <button class="px-6 py-2 rounded-full font-semibold bg-white/10 opacity-50 cursor-not-allowed" disabled>
                    üó£Ô∏è Speaking
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content - Reading Section -->
    <div x-show="currentSection === 'reading'" class="flex h-[calc(100vh-72px)]">

        <!-- Left Panel - Passage -->
        <div class="w-1/2 p-6 overflow-auto border-r border-white/10">
            <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                <h2 class="text-2xl font-bold mb-4 text-pink-400" x-text="currentPassage?.title"></h2>
                <p class="text-white/60 text-sm mb-4 italic" x-text="currentPassage?.subtitle"></p>
                <div class="passage-text text-white/90 text-lg" x-html="currentPassage?.content"></div>
            </div>
        </div>

        <!-- Right Panel - Questions -->
        <div class="w-1/2 p-6 overflow-auto">
            <div class="space-y-6">

                <!-- Questions Section -->
                <template x-for="(section, sectionIndex) in currentPassage?.questions" :key="sectionIndex">
                    <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">

                        <!-- Section Header -->
                        <div class="mb-6">
                            <h3 class="text-xl font-bold text-yellow-400 mb-2" x-text="section.title"></h3>
                            <p class="text-white/60 text-sm" x-text="section.instructions"></p>
                        </div>

                        <!-- TRUE/FALSE/NOT GIVEN Questions -->
                        <template x-if="section.type === 'tfng'">
                            <div class="space-y-4">
                                <template x-for="(q, qIndex) in section.items" :key="qIndex">
                                    <div class="question-card rounded-xl p-4">
                                        <p class="text-white mb-3">
                                            <span class="text-pink-400 font-bold" x-text="q.number + '.'"></span>
                                            <span x-text="q.text"></span>
                                        </p>
                                        <div class="flex gap-3">
                                            <template x-for="option in ['TRUE', 'FALSE', 'NOT GIVEN']" :key="option">
                                                <button @click="!submitted && setAnswer(q.number, option)" :class="{
                                                        'selected': answers[q.number] === option && !submitted,
                                                        'correct': submitted && q.answer === option,
                                                        'incorrect': submitted && answers[q.number] === option && q.answer !== option
                                                    }"
                                                    class="radio-option px-4 py-2 rounded-lg border border-white/20 text-sm font-medium transition-all"
                                                    :disabled="submitted">
                                                    <span x-text="option"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- MATCHING PARAGRAPHS Questions -->
                        <template x-if="section.type === 'matching'">
                            <div class="space-y-4">
                                <template x-for="(q, qIndex) in section.items" :key="qIndex">
                                    <div class="question-card rounded-xl p-4">
                                        <p class="text-white mb-3">
                                            <span class="text-pink-400 font-bold" x-text="q.number + '.'"></span>
                                            <span x-text="q.text"></span>
                                        </p>
                                        <div class="flex gap-2 flex-wrap">
                                            <template x-for="option in section.options" :key="option">
                                                <button @click="!submitted && setAnswer(q.number, option)" :class="{
                                                        'selected': answers[q.number] === option && !submitted,
                                                        'correct': submitted && q.answer === option,
                                                        'incorrect': submitted && answers[q.number] === option && q.answer !== option
                                                    }"
                                                    class="radio-option px-3 py-2 rounded-lg border border-white/20 text-sm font-medium transition-all"
                                                    :disabled="submitted">
                                                    <span x-text="option"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- MATCHING PEOPLE Questions -->
                        <template x-if="section.type === 'matchPeople'">
                            <div class="space-y-4">
                                <!-- People List -->
                                <div class="bg-white/5 rounded-xl p-4 border border-white/10 mb-4">
                                    <p class="text-white/80 font-semibold mb-2">List of People:</p>
                                    <template x-for="(person, idx) in section.people" :key="idx">
                                        <p class="text-white/70"><span class="text-pink-400 font-bold"
                                                x-text="person.letter + '.'"></span> <span x-text="person.name"></span>
                                        </p>
                                    </template>
                                </div>
                                <template x-for="(q, qIndex) in section.items" :key="qIndex">
                                    <div class="question-card rounded-xl p-4">
                                        <p class="text-white mb-3">
                                            <span class="text-pink-400 font-bold" x-text="q.number + '.'"></span>
                                            <span x-text="q.text"></span>
                                        </p>
                                        <div class="flex gap-2">
                                            <template x-for="person in section.people" :key="person.letter">
                                                <button @click="!submitted && setAnswer(q.number, person.letter)"
                                                    :class="{
                                                        'selected': answers[q.number] === person.letter && !submitted,
                                                        'correct': submitted && q.answer === person.letter,
                                                        'incorrect': submitted && answers[q.number] === person.letter && q.answer !== person.letter
                                                    }"
                                                    class="radio-option px-4 py-2 rounded-lg border border-white/20 text-sm font-medium transition-all"
                                                    :disabled="submitted">
                                                    <span x-text="person.letter"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- NOTE COMPLETION Questions -->
                        <template x-if="section.type === 'notes'">
                            <div class="space-y-4">
                                <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                                    <h4 class="text-lg font-semibold text-white mb-4" x-text="section.noteTitle"></h4>
                                    <div class="space-y-3">
                                        <template x-for="(item, itemIndex) in section.items" :key="itemIndex">
                                            <div>
                                                <template x-if="item.isHeader">
                                                    <p class="text-yellow-400 font-semibold mt-4 mb-2"
                                                        x-text="item.text"></p>
                                                </template>
                                                <template x-if="!item.isHeader">
                                                    <p class="text-white/90 flex items-center gap-2 flex-wrap">
                                                        <span>‚Ä¢</span>
                                                        <template x-for="(part, partIndex) in item.parts"
                                                            :key="partIndex">
                                                            <span>
                                                                <template x-if="part.type === 'text'">
                                                                    <span x-text="part.value"></span>
                                                                </template>
                                                                <template x-if="part.type === 'blank'">
                                                                    <span class="inline-flex items-center gap-1">
                                                                        <span class="text-pink-400 font-bold"
                                                                            x-text="part.number"></span>
                                                                        <input type="text"
                                                                            x-model="answers[part.number]"
                                                                            :disabled="submitted" :class="{
                                                                                'correct': submitted && isCorrectFill(section, part.number),
                                                                                'incorrect': submitted && !isCorrectFill(section, part.number) && answers[part.number]
                                                                            }"
                                                                            class="fill-input w-32 px-3 py-1 rounded text-white text-center"
                                                                            placeholder="...">
                                                                        <span
                                                                            x-show="submitted && !isCorrectFill(section, part.number)"
                                                                            class="text-green-400 text-sm ml-1"
                                                                            x-text="'(' + section.answers[part.number] + ')'"></span>
                                                                    </span>
                                                                </template>
                                                            </span>
                                                        </template>
                                                    </p>
                                                </template>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- SUMMARY COMPLETION Questions -->
                        <template x-if="section.type === 'summary'">
                            <div class="space-y-4">
                                <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                                    <h4 class="text-lg font-semibold text-white mb-4" x-text="section.summaryTitle">
                                    </h4>
                                    <p class="text-white/90 leading-relaxed">
                                        <template x-for="(part, partIndex) in section.parts" :key="partIndex">
                                            <span>
                                                <template x-if="part.type === 'text'">
                                                    <span x-text="part.value"></span>
                                                </template>
                                                <template x-if="part.type === 'blank'">
                                                    <span class="inline-flex items-center gap-1 mx-1">
                                                        <span class="text-pink-400 font-bold"
                                                            x-text="part.number"></span>
                                                        <input type="text" x-model="answers[part.number]"
                                                            :disabled="submitted" :class="{
                                                                'correct': submitted && isCorrectFill(section, part.number),
                                                                'incorrect': submitted && !isCorrectFill(section, part.number) && answers[part.number]
                                                            }"
                                                            class="fill-input w-28 px-3 py-1 rounded text-white text-center"
                                                            placeholder="...">
                                                        <span x-show="submitted && !isCorrectFill(section, part.number)"
                                                            class="text-green-400 text-sm ml-1"
                                                            x-text="'(' + section.answers[part.number] + ')'"></span>
                                                    </span>
                                                </template>
                                            </span>
                                        </template>
                                    </p>
                                </div>
                            </div>
                        </template>

                        <!-- MULTIPLE CHOICE Questions -->
                        <template x-if="section.type === 'multipleChoice'">
                            <div class="space-y-6">
                                <template x-for="(q, qIndex) in section.items" :key="qIndex">
                                    <div class="question-card rounded-xl p-4">
                                        <p class="text-white mb-4">
                                            <span class="text-pink-400 font-bold" x-text="q.number + '.'"></span>
                                            <span x-text="q.text"></span>
                                        </p>
                                        <div class="space-y-2">
                                            <template x-for="option in q.options" :key="option.letter">
                                                <button @click="!submitted && setAnswer(q.number, option.letter)"
                                                    :class="{
                                                        'selected': answers[q.number] === option.letter && !submitted,
                                                        'correct': submitted && q.answer === option.letter,
                                                        'incorrect': submitted && answers[q.number] === option.letter && q.answer !== option.letter
                                                    }"
                                                    class="radio-option w-full text-left px-4 py-3 rounded-lg border border-white/20 text-sm transition-all"
                                                    :disabled="submitted">
                                                    <span class="font-bold mr-2" x-text="option.letter"></span>
                                                    <span x-text="option.text"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- SENTENCE COMPLETION Questions -->
                        <template x-if="section.type === 'sentenceCompletion'">
                            <div class="space-y-4">
                                <!-- Endings List -->
                                <div class="bg-white/5 rounded-xl p-4 border border-white/10 mb-4">
                                    <p class="text-white/80 font-semibold mb-2">Sentence Endings:</p>
                                    <template x-for="(ending, idx) in section.endings" :key="idx">
                                        <p class="text-white/70 mb-1">
                                            <span class="text-pink-400 font-bold" x-text="ending.letter + '.'"></span>
                                            <span x-text="ending.text"></span>
                                        </p>
                                    </template>
                                </div>
                                <template x-for="(q, qIndex) in section.items" :key="qIndex">
                                    <div class="question-card rounded-xl p-4">
                                        <p class="text-white mb-3">
                                            <span class="text-pink-400 font-bold" x-text="q.number + '.'"></span>
                                            <span x-text="q.text"></span>
                                        </p>
                                        <div class="flex gap-2 flex-wrap">
                                            <template x-for="ending in section.endings" :key="ending.letter">
                                                <button @click="!submitted && setAnswer(q.number, ending.letter)"
                                                    :class="{
                                                        'selected': answers[q.number] === ending.letter && !submitted,
                                                        'correct': submitted && q.answer === ending.letter,
                                                        'incorrect': submitted && answers[q.number] === ending.letter && q.answer !== ending.letter
                                                    }"
                                                    class="radio-option px-4 py-2 rounded-lg border border-white/20 text-sm font-medium transition-all"
                                                    :disabled="submitted">
                                                    <span x-text="ending.letter"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- YES/NO/NOT GIVEN Questions -->
                        <template x-if="section.type === 'yesNoNotGiven'">
                            <div class="space-y-4">
                                <template x-for="(q, qIndex) in section.items" :key="qIndex">
                                    <div class="question-card rounded-xl p-4">
                                        <p class="text-white mb-3">
                                            <span class="text-pink-400 font-bold" x-text="q.number + '.'"></span>
                                            <span x-text="q.text"></span>
                                        </p>
                                        <div class="flex gap-3">
                                            <template x-for="option in ['YES', 'NO', 'NOT GIVEN']" :key="option">
                                                <button @click="!submitted && setAnswer(q.number, option)" :class="{
                                                        'selected': answers[q.number] === option && !submitted,
                                                        'correct': submitted && q.answer === option,
                                                        'incorrect': submitted && answers[q.number] === option && q.answer !== option
                                                    }"
                                                    class="radio-option px-4 py-2 rounded-lg border border-white/20 text-sm font-medium transition-all"
                                                    :disabled="submitted">
                                                    <span x-text="option"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                    </div>
                </template>

                <!-- Submit / Results -->
                <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                    <template x-if="!submitted">
                        <button @click="submitAnswers()"
                            class="w-full bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white font-bold py-4 px-8 rounded-xl transition-all text-lg">
                            Submit Answers ‚úì
                        </button>
                    </template>
                    <template x-if="submitted">
                        <div class="text-center">
                            <div class="text-4xl font-bold mb-2">
                                <span class="text-green-400" x-text="score"></span>
                                <span class="text-white/60" x-text="'/ ' + totalQuestions"></span>
                            </div>
                            <p class="text-white/60 mb-4">Correct Answers</p>
                            <button @click="resetQuiz()"
                                class="bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-8 rounded-xl transition-all">
                                Try Again üîÑ
                            </button>
                        </div>
                    </template>
                </div>

            </div>
        </div>

    </div>

    <!-- Main Content - Listening Section -->
    <div x-show="currentSection === 'listening'" class="flex h-[calc(100vh-72px)]">

        <!-- Left Panel - Video -->
        <div class="w-1/2 p-6 overflow-auto border-r border-white/10">
            <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                <h2 class="text-2xl font-bold mb-4 text-green-400" x-text="listeningData?.title || 'IELTS Listening'">
                </h2>

                <!-- YouTube Video Embed -->
                <div class="relative w-full" style="padding-bottom: 56.25%;">
                    <iframe x-show="listeningData?.videoUrl" :src="getYoutubeEmbedUrl(listeningData?.videoUrl)"
                        class="absolute top-0 left-0 w-full h-full rounded-xl" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>

                <!-- Instructions -->
                <div class="mt-6 p-4 bg-white/5 rounded-xl border border-white/10">
                    <h3 class="text-lg font-semibold text-yellow-400 mb-2">üìã Instructions</h3>
                    <p class="text-white/80 text-sm leading-relaxed">
                        1. Watch the video and listen carefully to the audio.<br>
                        2. Answer the questions in the right panel as you listen.<br>
                        3. You can pause and rewind the video as needed.<br>
                        4. Submit your answers when you're ready.
                    </p>
                </div>
            </div>
        </div>

        <!-- Right Panel - Questions -->
        <div class="w-1/2 p-6 overflow-auto">
            <div class="space-y-6">

                <!-- Part Selector - At Top -->
                <div class="bg-black/30 backdrop-blur-xl rounded-2xl p-4 border border-white/10 sticky top-0 z-10">
                    <div class="flex gap-2 flex-wrap justify-center">
                        <template x-for="(part, index) in listeningData?.parts" :key="index">
                            <button @click="currentListeningPartIndex = index; loadListeningPart()"
                                :class="currentListeningPartIndex === index ? 'bg-green-500 text-white' : 'bg-white/10 hover:bg-white/20 text-white/70'"
                                class="px-6 py-3 rounded-lg font-semibold transition-all">
                                <span x-text="part.title"></span>
                            </button>
                        </template>
                    </div>
                </div>

                <!-- Part Header -->
                <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                    <h3 class="text-xl font-bold text-green-400 mb-2"
                        x-text="currentListeningPart?.title + ' - ' + currentListeningPart?.description"></h3>
                    <p class="text-white/60 text-sm" x-text="currentListeningPart?.instructions"></p>
                </div>

                <!-- Notes Type Questions -->
                <template x-if="currentListeningPart?.type === 'notes'">
                    <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                        <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                            <h4 class="text-lg font-semibold text-white mb-4" x-text="currentListeningPart?.noteTitle">
                            </h4>
                            <div class="space-y-3">
                                <template x-for="(item, itemIndex) in currentListeningPart?.items" :key="itemIndex">
                                    <div>
                                        <template x-if="item.isHeader">
                                            <p class="text-yellow-400 font-semibold mt-4 mb-2" x-text="item.text"></p>
                                        </template>
                                        <template x-if="!item.isHeader">
                                            <p class="text-white/90 flex items-center gap-2 flex-wrap">
                                                <span>‚Ä¢</span>
                                                <template x-for="(part, partIndex) in item.parts" :key="partIndex">
                                                    <span>
                                                        <template x-if="part.type === 'text'">
                                                            <span x-text="part.value"></span>
                                                        </template>
                                                        <template x-if="part.type === 'blank'">
                                                            <span class="inline-flex items-center gap-1">
                                                                <span class="text-green-400 font-bold"
                                                                    x-text="part.number"></span>
                                                                <input type="text"
                                                                    x-model="listeningAnswers[part.number]"
                                                                    :disabled="listeningSubmitted" :class="{
                                                                        'correct': listeningSubmitted && isCorrectListeningFill(part.number),
                                                                        'incorrect': listeningSubmitted && !isCorrectListeningFill(part.number) && listeningAnswers[part.number]
                                                                    }"
                                                                    class="fill-input w-32 px-3 py-1 rounded text-white text-center"
                                                                    placeholder="...">
                                                                <span
                                                                    x-show="listeningSubmitted && !isCorrectListeningFill(part.number)"
                                                                    class="text-green-400 text-sm ml-1"
                                                                    x-text="'(' + currentListeningPart?.answers[part.number] + ')'"></span>
                                                            </span>
                                                        </template>
                                                    </span>
                                                </template>
                                            </p>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Table Section (for Part 1 guitar lesson table) -->
                        <template x-if="currentListeningPart?.tableSection">
                            <div class="bg-white/5 rounded-xl p-4 border border-white/10 mt-4">
                                <h4 class="text-lg font-semibold text-white mb-4 text-center"
                                    x-text="currentListeningPart?.tableSection.title"></h4>
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-white/20">
                                            <template x-for="header in currentListeningPart?.tableSection.headers"
                                                :key="header">
                                                <th class="text-left py-3 px-4 text-yellow-400 font-semibold"
                                                    x-text="header"></th>
                                            </template>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(row, rowIndex) in currentListeningPart?.tableSection.rows"
                                            :key="rowIndex">
                                            <tr class="border-b border-white/10">
                                                <td class="py-4 px-4 text-white/80" x-text="row.time"></td>
                                                <td class="py-4 px-4 text-white/80" x-text="row.activity"></td>
                                                <td class="py-4 px-4 text-white/90">
                                                    <template x-for="(part, partIndex) in row.notes" :key="partIndex">
                                                        <span>
                                                            <template x-if="part.type === 'text'">
                                                                <span x-text="part.value"></span>
                                                            </template>
                                                            <template x-if="part.type === 'blank'">
                                                                <span class="inline-flex items-center gap-1">
                                                                    <span class="text-green-400 font-bold"
                                                                        x-text="part.number"></span>
                                                                    <input type="text"
                                                                        x-model="listeningAnswers[part.number]"
                                                                        :disabled="listeningSubmitted" :class="{
                                                                            'correct': listeningSubmitted && isCorrectTableFill(part.number),
                                                                            'incorrect': listeningSubmitted && !isCorrectTableFill(part.number) && listeningAnswers[part.number]
                                                                        }"
                                                                        class="fill-input w-28 px-3 py-1 rounded text-white text-center"
                                                                        placeholder="...">
                                                                    <span
                                                                        x-show="listeningSubmitted && !isCorrectTableFill(part.number)"
                                                                        class="text-green-400 text-sm ml-1"
                                                                        x-text="'(' + currentListeningPart?.tableSection.tableAnswers[part.number] + ')'"></span>
                                                                </span>
                                                            </template>
                                                        </span>
                                                    </template>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </template>
                    </div>
                </template>

                <!-- Multiple Choice Questions -->
                <template x-if="currentListeningPart?.type === 'multipleChoice'">
                    <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                        <div class="space-y-6">
                            <template x-for="(q, qIndex) in currentListeningPart?.items" :key="qIndex">
                                <div>
                                    <!-- Regular Multiple Choice  -->
                                    <template x-if="!q.type">
                                        <div class="question-card rounded-xl p-4">
                                            <p class="text-white mb-4">
                                                <span class="text-green-400 font-bold" x-text="q.number + '.'"></span>
                                                <span x-text="q.text"></span>
                                            </p>
                                            <div class="space-y-2">
                                                <template x-for="option in q.options" :key="option.letter">
                                                    <button
                                                        @click="!listeningSubmitted && setListeningAnswer(q.number, option.letter)"
                                                        :class="{
                                                            'selected': listeningAnswers[q.number] === option.letter && !listeningSubmitted,
                                                            'correct': listeningSubmitted && q.answer === option.letter,
                                                            'incorrect': listeningSubmitted && listeningAnswers[q.number] === option.letter && q.answer !== option.letter
                                                        }"
                                                        class="radio-option w-full text-left px-4 py-3 rounded-lg border border-white/20 text-sm transition-all"
                                                        :disabled="listeningSubmitted">
                                                        <span class="font-bold mr-2" x-text="option.letter"></span>
                                                        <span x-text="option.text"></span>
                                                    </button>
                                                </template>
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Choose Two Group -->
                                    <template x-if="q.type === 'chooseTwoGroup'">
                                        <div class="question-card rounded-xl p-4 mb-4">
                                            <div class="mb-4">
                                                <p class="text-green-400 font-bold text-lg mb-2">
                                                    Questions <span x-text="q.questionNumbers.join(' and ')"></span>
                                                </p>
                                                <p class="text-white/80 text-sm mb-3">Choose TWO letters, A-E.</p>
                                                <p class="text-white mb-4" x-text="q.text"></p>
                                            </div>
                                            <div class="space-y-2">
                                                <template x-for="option in q.options" :key="option.letter">
                                                    <button
                                                        @click="!listeningSubmitted && toggleChooseTwoAnswer(q.questionNumbers, option.letter)"
                                                        :class="{
                                                            'selected': isChooseTwoSelected(q.questionNumbers, option.letter) && !listeningSubmitted,
                                                            'correct': listeningSubmitted && q.answers.includes(option.letter),
                                                            'incorrect': listeningSubmitted && isChooseTwoSelected(q.questionNumbers, option.letter) && !q.answers.includes(option.letter)
                                                        }"
                                                        class="radio-option w-full text-left px-4 py-3 rounded-lg border border-white/20 text-sm transition-all flex items-center gap-3"
                                                        :disabled="listeningSubmitted">
                                                        <span
                                                            class="w-6 h-6 rounded border-2 flex items-center justify-center text-xs"
                                                            :class="isChooseTwoSelected(q.questionNumbers, option.letter) ? 'bg-green-500 border-green-500' : 'border-white/40'">
                                                            <span
                                                                x-show="isChooseTwoSelected(q.questionNumbers, option.letter)">‚úì</span>
                                                        </span>
                                                        <span class="font-bold" x-text="option.letter + '.'"></span>
                                                        <span x-text="option.text"></span>
                                                    </button>
                                                </template>
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Matching Group -->
                                    <template x-if="q.type === 'matchingGroup'">
                                        <div class="question-card rounded-xl p-4 mb-4">
                                            <div class="mb-4">
                                                <p class="text-green-400 font-bold text-lg mb-2" x-text="q.title"></p>
                                                <p class="text-white mb-2" x-text="q.text"></p>
                                                <p class="text-white/60 text-sm" x-text="q.instructions"></p>
                                            </div>

                                            <!-- Options Box -->
                                            <div class="bg-white/5 rounded-xl p-4 border border-white/10 mb-4">
                                                <p class="text-yellow-400 font-semibold mb-3">Footwear</p>
                                                <div class="flex flex-wrap gap-2">
                                                    <template x-for="option in q.options" :key="option.letter">
                                                        <div class="bg-white/10 px-3 py-2 rounded-lg text-sm">
                                                            <span class="text-green-400 font-bold"
                                                                x-text="option.letter + '.'"></span>
                                                            <span class="text-white/80" x-text="option.text"></span>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>

                                            <!-- Items to Match -->
                                            <div class="space-y-3">
                                                <template x-for="item in q.items" :key="item.number">
                                                    <div class="flex items-center gap-4 p-3 bg-white/5 rounded-lg">
                                                        <span class="text-green-400 font-bold w-8"
                                                            x-text="item.number"></span>
                                                        <span class="text-white flex-1" x-text="item.label"></span>
                                                        <select x-model="listeningAnswers[item.number]"
                                                            :disabled="listeningSubmitted" :class="{
                                                                'correct': listeningSubmitted && listeningAnswers[item.number] === q.answers[item.number],
                                                                'incorrect': listeningSubmitted && listeningAnswers[item.number] && listeningAnswers[item.number] !== q.answers[item.number]
                                                            }"
                                                            class="fill-input px-4 py-2 rounded-lg text-white w-20 text-center">
                                                            <option value="" class="bg-gray-800">-</option>
                                                            <template x-for="option in q.options" :key="option.letter">
                                                                <option :value="option.letter" x-text="option.letter"
                                                                    class="bg-gray-800"></option>
                                                            </template>
                                                        </select>
                                                        <span
                                                            x-show="listeningSubmitted && listeningAnswers[item.number] !== q.answers[item.number]"
                                                            class="text-green-400 text-sm"
                                                            x-text="'(' + q.answers[item.number] + ')'"></span>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Submit / Results for Listening -->
                <div class="bg-black/20 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
                    <template x-if="!listeningSubmitted">
                        <button @click="submitListeningAnswers()"
                            class="w-full bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-4 px-8 rounded-xl transition-all text-lg">
                            Submit Answers ‚úì
                        </button>
                    </template>
                    <template x-if="listeningSubmitted">
                        <div class="text-center">
                            <div class="text-4xl font-bold mb-2">
                                <span class="text-green-400" x-text="listeningScore"></span>
                                <span class="text-white/60" x-text="'/ ' + listeningTotalQuestions"></span>
                            </div>
                            <p class="text-white/60 mb-4">Correct Answers</p>
                            <button @click="resetListeningQuiz()"
                                class="bg-white/10 hover:bg-white/20 text-white font-bold py-3 px-8 rounded-xl transition-all">
                                Try Again üîÑ
                            </button>
                        </div>
                    </template>
                </div>

            </div>
        </div>

    </div>

    <script>
        function ieltsApp() {
            return {
                selectedTestSet: 1,
                currentSection: 'reading',
                currentPassageIndex: 0,
                currentPassage: null,
                currentPassages: [],
                answers: {},
                submitted: false,
                score: 0,
                totalQuestions: 0,
                loading: true,

                // Listening state
                listeningData: null,
                currentListeningPartIndex: 0,
                currentListeningPart: null,
                listeningAnswers: {},
                listeningSubmitted: false,
                listeningScore: 0,
                listeningTotalQuestions: 0,

                testSets: [
                    { id: 1, name: "Test 1", file: "ielts-tests/test1.json" }
                ],

                async init() {
                    await this.loadTestSet();
                },

                async loadTestSet() {
                    this.loading = true;
                    const testConfig = this.testSets.find(t => t.id === parseInt(this.selectedTestSet));
                    if (testConfig && testConfig.file) {
                        try {
                            const response = await fetch(testConfig.file);
                            const testData = await response.json();

                            // Load Reading
                            if (testData.reading && testData.reading.passages.length > 0) {
                                this.currentPassages = testData.reading.passages;
                                this.currentPassageIndex = 0;
                                this.loadPassage();
                            }

                            // Load Listening
                            if (testData.listening) {
                                this.listeningData = testData.listening;
                                this.currentListeningPartIndex = 0;
                                this.loadListeningPart();
                            }
                        } catch (error) {
                            console.error('Error loading test:', error);
                        }
                    }
                    this.loading = false;
                },

                // Reading functions
                loadPassage() {
                    this.currentPassage = this.currentPassages[this.currentPassageIndex];
                    this.resetQuiz();
                },

                setAnswer(number, value) {
                    this.answers[number] = value;
                },

                isCorrectFill(section, number) {
                    if (!section.answers) return false;
                    const userAnswer = (this.answers[number] || '').toLowerCase().trim();
                    const correctAnswer = (section.answers[number] || '').toLowerCase().trim();
                    return userAnswer === correctAnswer;
                },

                submitAnswers() {
                    this.submitted = true;
                    this.score = 0;
                    this.totalQuestions = 0;

                    this.currentPassage?.questions.forEach(section => {
                        if (section.type === 'tfng' || section.type === 'matching' || section.type === 'matchPeople' ||
                            section.type === 'multipleChoice' || section.type === 'sentenceCompletion' || section.type === 'yesNoNotGiven') {
                            section.items.forEach(item => {
                                this.totalQuestions++;
                                if (this.answers[item.number] === item.answer) {
                                    this.score++;
                                }
                            });
                        } else if (section.type === 'notes' || section.type === 'summary') {
                            if (section.answers) {
                                Object.keys(section.answers).forEach(num => {
                                    this.totalQuestions++;
                                    if (this.isCorrectFill(section, parseInt(num))) {
                                        this.score++;
                                    }
                                });
                            }
                        }
                    });
                },

                resetQuiz() {
                    this.answers = {};
                    this.submitted = false;
                    this.score = 0;
                    this.totalQuestions = 0;
                },

                // Listening functions
                getYoutubeEmbedUrl(url) {
                    if (!url) return '';
                    const videoId = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
                    if (videoId && videoId[1]) {
                        return `https://www.youtube.com/embed/${videoId[1]}`;
                    }
                    return '';
                },

                loadListeningPart() {
                    if (this.listeningData && this.listeningData.parts) {
                        this.currentListeningPart = this.listeningData.parts[this.currentListeningPartIndex];
                        this.resetListeningQuiz();
                    }
                },

                setListeningAnswer(number, value) {
                    this.listeningAnswers[number] = value;
                },

                isCorrectListeningFill(number) {
                    if (!this.currentListeningPart?.answers) return false;
                    const userAnswer = (this.listeningAnswers[number] || '').toLowerCase().trim();
                    const correctAnswer = (this.currentListeningPart.answers[number] || '').toLowerCase().trim();
                    return userAnswer === correctAnswer;
                },

                isCorrectTableFill(number) {
                    if (!this.currentListeningPart?.tableSection?.tableAnswers) return false;
                    const userAnswer = (this.listeningAnswers[number] || '').toLowerCase().trim();
                    const correctAnswer = (this.currentListeningPart.tableSection.tableAnswers[number] || '').toLowerCase().trim();
                    return userAnswer === correctAnswer;
                },

                // Choose Two Group functions
                toggleChooseTwoAnswer(questionNumbers, letter) {
                    const selectedLetters = [];
                    questionNumbers.forEach(num => {
                        if (this.listeningAnswers[num]) {
                            selectedLetters.push(this.listeningAnswers[num]);
                        }
                    });

                    if (selectedLetters.includes(letter)) {
                        // Remove the letter
                        questionNumbers.forEach(num => {
                            if (this.listeningAnswers[num] === letter) {
                                this.listeningAnswers[num] = null;
                            }
                        });
                    } else if (selectedLetters.length < 2) {
                        // Add the letter to first empty slot
                        for (const num of questionNumbers) {
                            if (!this.listeningAnswers[num]) {
                                this.listeningAnswers[num] = letter;
                                break;
                            }
                        }
                    }
                },

                isChooseTwoSelected(questionNumbers, letter) {
                    return questionNumbers.some(num => this.listeningAnswers[num] === letter);
                },

                submitListeningAnswers() {
                    this.listeningSubmitted = true;
                    this.listeningScore = 0;
                    this.listeningTotalQuestions = 0;

                    const part = this.currentListeningPart;
                    if (!part) return;

                    if (part.type === 'multipleChoice') {
                        part.items.forEach(item => {
                            if (item.type === 'chooseTwoGroup') {
                                // Count as 2 questions
                                this.listeningTotalQuestions += 2;
                                const userAnswers = item.questionNumbers.map(n => this.listeningAnswers[n]).filter(Boolean);
                                item.answers.forEach(ans => {
                                    if (userAnswers.includes(ans)) {
                                        this.listeningScore++;
                                    }
                                });
                            } else if (item.type === 'matchingGroup') {
                                // Count each matching item
                                item.items.forEach(matchItem => {
                                    this.listeningTotalQuestions++;
                                    if (this.listeningAnswers[matchItem.number] === item.answers[matchItem.number]) {
                                        this.listeningScore++;
                                    }
                                });
                            } else if (item.number) {
                                this.listeningTotalQuestions++;
                                if (this.listeningAnswers[item.number] === item.answer) {
                                    this.listeningScore++;
                                }
                            }
                        });
                    } else if (part.type === 'notes' || part.type === 'table') {
                        // Check regular notes answers
                        if (part.answers) {
                            Object.keys(part.answers).forEach(num => {
                                this.listeningTotalQuestions++;
                                if (this.isCorrectListeningFill(parseInt(num))) {
                                    this.listeningScore++;
                                }
                            });
                        }
                        // Check table section answers
                        if (part.tableSection && part.tableSection.tableAnswers) {
                            Object.keys(part.tableSection.tableAnswers).forEach(num => {
                                this.listeningTotalQuestions++;
                                if (this.isCorrectTableFill(parseInt(num))) {
                                    this.listeningScore++;
                                }
                            });
                        }
                    }
                },

                resetListeningQuiz() {
                    this.listeningAnswers = {};
                    this.listeningSubmitted = false;
                    this.listeningScore = 0;
                    this.listeningTotalQuestions = 0;
                }
            };
        }
    </script>

</body>

</html>